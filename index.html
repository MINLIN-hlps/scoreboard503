// Google Apps Script - 後端
function doPost(e) {
  try {
    const sheetName = '鎖定區';
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName(sheetName);
    const data = JSON.parse(e.postData.contents);

    data.forEach(entry => {
      sheet.appendRow([new Date(), entry.rater, entry.target, entry.score]);
    });

    return ContentService.createTextOutput("成功寫入");
  } catch (err) {
    return ContentService.createTextOutput("錯誤：" + err);
  }
}

function doGet() {
  const sheetName = '鎖定區';
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sheetName);
  const rows = sheet.getDataRange().getValues();
  const headers = rows[0];
  const data = rows.slice(1).map(row => {
    let obj = {};
    headers.forEach((key, i) => obj[key] = row[i]);
    return obj;
  });
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}

<!-- 這是更新後的前端 HTML 略（保留您原本的 HTML 結構），
     我會加入載入現有評分紀錄的功能以及老師登入可看到所有評分紀錄的顯示 -->

<!-- 於 <script> 區段中新增： -->

window.onload = () => {
  fetch(googleScriptUrl)
    .then(res => res.json())
    .then(data => {
      data.forEach(entry => {
        const { rater, target, score } = entry;
        if (!submissions[target]) submissions[target] = {};
        submissions[target][rater] = parseFloat(score);
        scores[target] = Object.values(submissions[target]);
      });
      if (currentStudentId !== null) {
        renderScoringUI();
        if (currentStudentId === 0) updateTeacherStats();
      }
    })
    .catch(err => console.error("讀取 Google 試算表失敗：", err));
};
